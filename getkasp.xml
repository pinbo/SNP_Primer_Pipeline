<tool id="snpmarker" name="SNP Primer Design">
  <description>for each sequence in a CSV file</description>
  <command interpreter="python">run_getkasp.py $input $ploidy $price $CAPS $KASP $blast</command>
  <inputs>
    <param format="txt" name="input" type="data" label="CSV file"/>
    <param name="ploidy" size="4" type="integer" value="3" label="Ploidy"/>
    <param name="price" size="4" type="integer" value="200" label="Maximum NEB restriction enzyme price"/>
    <param name="CAPS" type="select" label="Design CAPS/dCAPS primers?" help="If yes, CAPS/dCAPS primers will be designed.">
        <option value="1">Yes</option>
        <option value="0">No</option>
    </param>
    <param name="KASP" type="select" label="Design KASP primers?" help="If yes, KASP primers will be designed.">
        <option value="1">Yes</option>
        <option value="0">No</option>
    </param>
    <param name="blast" type="select" label="Blast the output primers in the wheat genome?" help="If yes, will blast against Chinese_Spring_v1.0_pseudomolecules.">
        <option value="1">Yes</option>
        <option value="0">No</option>
    </param>
  </inputs>
  <outputs>
      <data format="tabular" name="caps_out" from_work_dir="Potential_CAPS_primers.tsv" label="${tool.name} CAPS primer output"/>
	  <data format="tabular" name="kasp_out" from_work_dir="Potential_KASP_primers.tsv" label="${tool.name} KASP primer output"/>
	  <data format="fasta" name="alignment_out" from_work_dir="All_alignment_raw.fa" label="${tool.name} Sequence Alignments"/>
  </outputs>

  <help>

**OVERVIEW**

This pipeline can make KASP primers and CAPS/dCAPS primers based on SNP flanking sequences.

The input file is the same as polymarker, e.g. a csv file with each line looks like this:

IWA7892,1BL,AGGATTCACGGGAAAAGATTTCGTCGCA[C/T]GTGCTAGGGTCTTTGCAGAATGTTA


**Restriction Enzymes**

Restriction Enzymes used in this tool are all from NEB. And the prices were obtained on 05/29/2017.

I processed these enzymes and enzymes with the same recognization sequences were merged together. For example, MspI and HpaII both recognize "ccgg", so I give them the name "MspI,HpaII,13"; the number in the end is the lowest price (US dolloars per 1000 U) of the enzyme group.

**Output Format**

Three output files will be availabe after each run: 

1. Multiple sequence alignment file for each marker

2. Primer pairs for KASP design, and

3. primer pairs for CAPS design.

For the KASP and CAPS output, below the primer pairs for each marker are the positions that can differ all the other homeologs. These positions are used for 3' start of primers in Primer3. When selecting primers, if it has more than 1 of these positions in the first 4 bases from the 3', then it would be more unique to this chromosome.

Results of **primer blast** against the IWGSC pseudomolecule v1.0 was in the last column of the KASP and CAPS output file. The selection criterion is: less than 2 mismatches in the first 4 bases from the 3' of each primer.

  </help>

</tool>
